/***********************************************************************************/
//                       I2C.C With MSP430F149 Driver For PCF8563
//Platform: IAR Embedded Workbench Version: 3.42A
//Version: 1.0.0
//Author:  LiHuaiLiang
//Email:   li-huai-liang@163.com
//QQ:      769996244
//Date:    2009-03-14
//Modify:  
//====================================================================================
//                      I2C.C With MSP430F149 Driver For PCF8563
//Platform: IAR Embedded Workbench Version: 3.42A
//版本: 1.0.0
//作者:  李怀良
//Email:   li-huai-liang@163.com
//QQ:      769996244
//日期:    2009-03-14
//修改:
///***********************************************************************************/
 
#include "IIC.h"

//==================================================================================
/********************************************************************************************************
** 函数名称: WriteDelay
** 功能描述:  
** 输　入: 无
** 输　出: 无
** 全局变量: 无
*-------------------------------------------------------------------------------------------------------
** 修改人:
** 日　期:
**------------------------------------------------------------------------------------------------------
********************************************************************************************************/
/*void WriteDelay(void)
{
  unsigned int i;
  for(i=0;i<8000;i++);
}
void Delay(unsigned int i)
{
    while(i-->0);
}*/
/********************************************************************************************************
** 函数名称: IICStart
** 功能描述: 
** 输　入: 无
** 输　出: 无
** 全局变量: 无
*-------------------------------------------------------------------------------------------------------
** 修改人:
** 日　期:
**------------------------------------------------------------------------------------------------------ 
********************************************************************************************************/
void IICStart(void)
{
  IICSetSDA();
  IICdelayus(20);
  IICSetSCL();
  IICdelayus(20);
  IICClrSDA();
  IICdelayus(20);  
  IICClrSCL();
}
/********************************************************************************************************
** 函数名称: IICStop
** 功能描述: 
** 输　入: 无
** 输　出: 无
** 全局变量: 无
*-------------------------------------------------------------------------------------------------------
** 修改人:
** 日　期:
**------------------------------------------------------------------------------------------------------
********************************************************************************************************/
void IICStop(void)
{
  IICClrSDA();
  IICdelayus(20); 
  IICSetSCL();IICdelayus(20);
  IICSetSDA();IICdelayus(20);
  IICSetSCL();IICdelayus(20);

}
/********************************************************************************************************
** 函数名称: IICReadAck
** 功能描述: 
** 输　入: 无
** 输　出: 无
** 全局变量: 无
*-------------------------------------------------------------------------------------------------------
** 修改人:
** 日　期:
**------------------------------------------------------------------------------------------------------
********************************************************************************************************/
char IICReadAck(void)
{
  char status;
  IICSetSDA();
  IICSDAIn();
  IICdelayus(20);
  IICSetSCL();  
  status=IICReadSDA();
  IICdelayus(20);
  IICClrSCL();
  IICSDAOut();
  IICdelayus(20);
  return(status);
}
/********************************************************************************************************
** 函数名称: IICWriteAck
** 功能描述: 
** 输　入: 无
** 输　出: 无
** 全局变量: 无
*-------------------------------------------------------------------------------------------------------
** 修改人:
** 日　期:
**------------------------------------------------------------------------------------------------------
********************************************************************************************************/
void IICWriteAck(void)
{
  IICSDAOut(); 
  IICClrSDA();
  IICdelayus(20);
  IICSetSCL();
  IICdelayus(20);
  IICClrSCL();  
  IICdelayus(20);
  IICSetSDA();
}
/********************************************************************************************************
** 函数名称: IICNoAck
** 功能描述: 
** 输　入: 无
** 输　出: 无
** 全局变量: 无
*-------------------------------------------------------------------------------------------------------
** 修改人:
** 日　期:
**------------------------------------------------------------------------------------------------------
********************************************************************************************************/
void IICNoAck(void)
{
  IICSDAOut();IICdelayus(20);
  IICSetSDA();
  IICdelayus(20);
  IICSetSCL();IICdelayus(20);
  IICClrSCL();IICdelayus(20);
}
/********************************************************************************************************
** 函数名称: IICWriteByte
** 功能描述: 
** 输　入: 无
** 输　出: 无
** 全局变量: 无
*-------------------------------------------------------------------------------------------------------
** 修改人:
** 日　期:
**------------------------------------------------------------------------------------------------------
********************************************************************************************************/
char IICWriteByte(char v)
{
  char i;
  for(i=0;i<8;i++)
  {
    if(v &0x80)
    {
      IICSetSDA();
    }
    else
    {
      IICClrSDA();
    }
    IICSetSCL();
    IICClrSCL();
    v=v<<1;
  };

//  IICSetSDA();
  IICSDAIn();
  IICdelayus(20);
  IICSetSCL(); 
  IICdelayus(20);
  i =IICReadSDA();
  IICClrSCL();
  IICdelayus(20);
  IICSDAOut();
  IICdelayus(20);
  return(i);
}
/********************************************************************************************************
** 函数名称: IICReadByteWithAck
** 功能描述: 
** 输　入: 无
** 输　出: 无
** 全局变量: 无
*-------------------------------------------------------------------------------------------------------
** 修改人:
** 日　期:
**------------------------------------------------------------------------------------------------------
********************************************************************************************************/
char IICReadByteWithAck(void)
{
  char rc,i;
  rc=0;
  
  IICSDAOut();
  IICSetSDA();
  IICdelayus(20);
  IICSDAIn();
  for(i=0;i<8;i++)
  { 
    rc=rc<<1;
    IICSetSCL();IICdelayus(20);
    rc=(IICReadSDA())?(rc | 0x01):(rc);
    IICClrSCL();IICdelayus(20);
  };
  
  IICWriteAck();
  return(rc);
}
/********************************************************************************************************
** 函数名称: IICReadByteWithoutAck
** 功能描述: 
** 输　入: 无 
** 输　出: 无
** 全局变量: 无
*-------------------------------------------------------------------------------------------------------
** 修改人:
** 日　期:
**------------------------------------------------------------------------------------------------------
********************************************************************************************************/
char IICReadByteWithoutAck(void)
{
  char rc,i;
  rc=0;
  
  IICSDAOut();
  IICSetSDA();
  
  IICSDAIn();
  for(i=0;i<8;i++)
  { 
    rc=rc<<1;
    IICSetSCL();    
    IICdelayus(20);
    rc=(IICReadSDA())?(rc | 0x01):(rc);
    IICClrSCL();
  };
  IICNoAck();
  return(rc);
}

